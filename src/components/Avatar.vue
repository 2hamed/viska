<template>
  <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" :class="$style.avatar" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024" xml:space="preserve">
    <g id="neck">
      <g>
        <g id="center_7_">
          <path fill="#777777" d="M546,928c0,11-9,20-20,20h-28c-11,0-20-9-20-20V682c0-11,9-20,20-20h28c11,0,20,9,20,20V928z"/>
        </g>
        <g id="top_7_">
          <path fill="#B9B9B9" d="M583.124,796.245C581.406,807.11,571,816,560,816h-96c-11,0-21.406-8.89-23.124-19.755l-14.152-89.491
            C425.006,695.89,432.6,687,443.6,687h136.8c11,0,18.594,8.89,16.876,19.755L583.124,796.245z"/>
        </g>
        <g id="bottom_7_">
          <path fill="#B9B9B9" d="M580,1061c0,11-9,20-20,20h-96c-11,0-20-9-20-20V925c0-11,9-20,20-20h96c11,0,20,9,20,20V1061z"/>
        </g>
      </g>
    </g>
    <g id="head" ref="head">
      <g id="antens">
        <g id="left_2_">
          <path fill="#777777" d="M412.688,346.771c1.881,5.168-0.808,10.936-5.977,12.817l-6.578,2.394
            c-5.168,1.881-10.936-0.808-12.817-5.977l-92.003-252.777c-1.881-5.168,0.808-10.936,5.977-12.817l6.578-2.394
            c5.168-1.881,10.936,0.808,12.817,5.977L412.688,346.771z"/>
        </g>
        <g id="left_1_">
          <path fill="#777777" d="M611.312,346.771c-1.881,5.168,0.808,10.936,5.977,12.817l6.578,2.394
            c5.168,1.881,10.936-0.808,12.817-5.977l92.003-252.777c1.881-5.168-0.808-10.936-5.977-12.817l-6.578-2.394
            c-5.168-1.881-10.936,0.808-12.817,5.977L611.312,346.771z"/>
        </g>
      </g>
      <g id="face">
        <g id="main_3_">
          <g opacity="0.1">
            <path d="M807,651c0,49.706-40.294,90-90,90H304c-49.706,0-90-40.294-90-90V411c0-49.706,40.294-90,90-90h413
              c49.706,0,90,40.294,90,90V651z"/>
          </g>
          <g>
            <path fill="#B9B9B9" d="M807,631c0,49.706-40.294,90-90,90H304c-49.706,0-90-40.294-90-90V391c0-49.706,40.294-90,90-90h413
              c49.706,0,90,40.294,90,90V631z"/>
          </g>
        </g>
        <g id="lines_1_">
          <g id="_x31_">
            <g opacity="0.1">
              <path d="M325,613c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V370c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15V613z"/>
            </g>
            <g>
              <path fill="#777777" d="M325,603c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V360c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15
                V603z"/>
            </g>
          </g>
          <g id="_x32_">
            <g opacity="0.1">
              <path d="M525,657c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V506.5c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15V657z"/>
            </g>
            <g>
              <path fill="#777777" d="M525,647c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V496.5c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15
                V647z"/>
            </g>
          </g>
          <g id="_x33_">
            <g opacity="0.1">
              <path d="M725,613c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V370c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15V613z"/>
            </g>
            <g>
              <path fill="#777777" d="M725,603c0,8.25-6.075,15-13.5,15s-13.5-6.75-13.5-15V360c0-8.25,6.075-15,13.5-15s13.5,6.75,13.5,15
                V603z"/>
            </g>
          </g>
        </g>
      </g>
      <g id="leap_1_" ref="leap">
        <g id="main_1_">
          <g opacity="0.1">
            <path d="M582,629c0,11.046-8.954,20-20,20h-99c-11.046,0-20-8.954-20-20v-24c0-11.046,8.954-20,20-20h99
              c11.046,0,20,8.954,20,20V629z"/>
          </g>
          <g>
            <path fill="#E9E9E9" d="M582,619c0,11.046-8.954,20-20,20h-99c-11.046,0-20-8.954-20-20v-24c0-11.046,8.954-20,20-20h99
              c11.046,0,20,8.954,20,20V619z"/>
          </g>
        </g>
      </g>
      <g id="eyes">
        <g id="left" ref="lefteye">
          <g id="main">
            <g opacity="0.1">
              <path d="M432,529c0,16.569-13.431,30-30,30H197c-16.569,0-30-13.431-30-30v-89c0-16.569,13.431-30,30-30h205
                c16.569,0,30,13.431,30,30V529z"/>
            </g>
            <g>
              <path fill="#E9E9E9" d="M432,509c0,16.569-13.431,30-30,30H197c-16.569,0-30-13.431-30-30v-89c0-16.569,13.431-30,30-30h205
                c16.569,0,30,13.431,30,30V509z"/>
            </g>
          </g>
          <circle id="circle" fill="#777777" cx="312" cy="464" r="55" ref="lefteyecircle"/>
        </g>
        <g id="right" ref="righteye">
          <g id="main_2_">
            <g opacity="0.1">
              <path d="M856,440c0-16.569-13.431-30-30-30H621c-16.569,0-30,13.431-30,30v89c0,16.569,13.431,30,30,30h205
                c16.569,0,30-13.431,30-30V440z"/>
            </g>
            <g>
              <path fill="#E9E9E9" d="M856,420c0-16.569-13.431-30-30-30H621c-16.569,0-30,13.431-30,30v89c0,16.569,13.431,30,30,30h205
                c16.569,0,30-13.431,30-30V420z"/>
            </g>
          </g>
          <circle id="circle_1_" fill="#777777" cx="712" cy="464" r="55" ref="righteyecircle"/>
        </g>
      </g>
    </g>
  </svg>
</template>

<script>
import { minifyStr, strToNumber } from '../../utils/handy.js';
export default {
  props: {
    name: {
      type: String,
      default: '',
    },
    size: {
      type: Number,
      default: 64,
    }
  },
  methods: {
    applyStyle() {
      const svg = this.$el;
      const head = this.$refs.head;
      const leap = this.$refs.leap;
      const lefteye = this.$refs.lefteye;
      const righteye = this.$refs.righteye;
      const lefteyecircle = this.$refs.lefteyecircle;
      const righteyecircle = this.$refs.righteyecircle;
  
      svg.style.width = this.size + 'px';
      svg.style.height = this.size + 'px';

      if (!this.name) {
        head.style.transform = null;
        leap.style.transform = null;
        lefteye.style.transform = null;
        righteye.style.transform = null;
        head.style.transform = null;
        lefteyecircle.style.fill = null;
        righteyecircle.style.fill = null;
        return;
      }
      
      const headDegree = strToNumber(this.name + 'head', 31) - 15;
      head.style.transformOrigin = 'center';
      head.style.transition = 'transform 0.3s';
      head.style.transform = `rotate(${headDegree}deg)`;


      // leap -8 to 1
      const leapPos = strToNumber(this.name + 'leapG', 10) - 8;
      leap.style.transition = 'transform 0.3s';
      leap.style.transform = `translateY(${leapPos}%)`;

      // lefteye -2 to 6
      const lefteyePos = strToNumber(this.name + 'lefteyeA', 9) - 2;
      lefteye.style.transition = 'transform 0.3s';
      lefteye.style.transform = `translateY(${lefteyePos}%)`;

      // righteye -2 to 6
      const righteyePos = strToNumber(this.name + 'righteyeZ', 9) - 2;
      righteye.style.transition = 'transform 0.3s';
      righteye.style.transform = `translateY(${righteyePos}%)`;

      // blue, red, yellow, green, purple
      const eyeColors = ['#39638a', '#8a3939', '#8a6f39', '#54712a', '#682a71'];

      // lefteyecircle
      lefteyecircle.style.transition = 'fill 0.3s';
      lefteyecircle.style.fill = eyeColors[strToNumber(this.name + 'lefteyecircleA', eyeColors.length)];

      // righteyecircle
      righteyecircle.style.transition = 'fill 0.3s';
      righteyecircle.style.fill = eyeColors[strToNumber(this.name + 'righteyecircleZ', eyeColors.length)];
    }
  },
  mounted() {
    this.$nextTick(() => {
      this.applyStyle();
    });
  },
  watch: {
    name() {
      this.applyStyle();
    },
    size() {
      this.applyStyle();
    },
  },
  style({ className, mediaQuery }) {
    return [
      className('avatar', {
        display: 'inline-block',
        position: 'relative',
      }),
    ];
  }
}
</script>